(function(){"use strict";var e={2269:function(e,t,n){var a=n(6369),o=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},i=[],s={name:"App"},r=s,l=n(1001),c=(0,l.Z)(r,o,i,!1,null,null,null),u=c.exports,d=n(7466),f=n.n(d),h=n(2631),p=function(){var e=this,t=e._self._c;return t("span",[e._v("hahahah")])},g=[],m={name:"pc-index"},v=m,y=(0,l.Z)(v,p,g,!1,null,"a91f1b6e",null),b=y.exports,w=function(){var e=this,t=e._self._c;return t("m-chat",{ref:"mChat",attrs:{messages:e.messages,loadMore:e.loadMore,height:"100vh",config:e.config,comment:!0},on:{submit:e.submit,extendItemClick:e.extendItemClick}})},x=[],M=(n(7658),n(4161)),O={BASE_URL:"/api/",FILE_DOWN_URL:"/api/file"};let S=O.BASE_URL,I=localStorage.getItem("code");function $(e,t={},n="GET"){return new Promise((function(a,o){(0,M.Z)({method:n,url:e,baseURL:S,data:t,withCredentials:!0,headers:{Authorization:"Bearer "+I}}).then((e=>{a(e.data)})).catch((e=>{console.log("Error: "),console.log(e),o(e)}))}))}var _={sendMessage(e){return $("/auth/vchat/",e,"POST")},getMessageByPage(e,t){return $(`/auth/vchat/list?page=${e}&size=${t}`)},getMyIp(e,t){return $("/auth/vchat/getMyIp")}},U={getNowDateStr(){let e=new Date,t=e.getFullYear(),n=("0"+(e.getMonth()+1)).slice(-2),a=("0"+e.getDate()).slice(-2),o=("0"+e.getHours()).slice(-2),i=("0"+e.getMinutes()).slice(-2),s=("0"+e.getSeconds()).slice(-2),r=`${t}-${n}-${a} ${o}:${i}:${s}`;return r}},k=(n(2801),n(3767),n(8585),n(8696),{dataURLtoFileFun(e,t){const n=e.split(","),a=n[0].match(/:(.*?);/)[1],o=atob(n[1]);let i=o.length;const s=new Uint8Array(i);while(i--)s[i]=o.charCodeAt(i);return new File([s],t,{type:a})}}),P={name:"mobile-index",data(){return{config:{theme:"light",image:{maxSize:20480,accept:["image/*"]},file:{maxSize:20480,accept:["*"]},video:{maxSize:20480,accept:["video/*"]},isImagePreview:!0,imagePreviewConfig:{closeable:!1},openExtends:["custom"],extendArr:[{type:"custom",text:"位置",icon:"location-o",classPrefix:"van-icon"}]},messages:[],fileList:[],ip:"",page:1}},async mounted(){await this.getMyIp(),this.getMessage()},methods:{async upload(e){try{const t=new FormData;t.append("file",k.dataURLtoFileFun(e.content,e.file.name));const n={headers:{"Content-Type":"multipart/form-data"}};let a=this.$toast.loading({message:"上传中...",duration:0}),o=await M.Z.post(O.BASE_URL+"/open/example/upload",t,n);if(a.clear(),2e4===o.data.code)return this.$toast("上传成功"),O.FILE_DOWN_URL+o.data.data;this.$toast("上传失败")}catch(t){console.error(t.response.data)}},async getMyIp(){let e=await _.getMyIp();this.ip=e.data},async getMessage(){console.log("当前页码为："+this.page);let e=await _.getMessageByPage(this.page,10);0!==e.length&&(this.messages||(this.messages=[]),this.messages=e.data.concat(this.messages),this.messages=this.messages.map((e=>(e.ip===this.ip&&(e.self=!0),e))))},async loadMore(){this.page++;let e=this.$toast.loading({message:"加载中...",duration:0});await this.getMessage(),e.clear()},async submit(e){console.log(e);let t={...e};switch(t.time=U.getNowDateStr(),t.ip=this.ip,t.content={text:"",duration:"",imageUrl:"",videoUrl:"",audioUrl:"",fileUrl:"",fileName:"",fileSize:"",fileExt:""},t.type=e.type,e.type){case"text":t.content.text=e.content;break;case"image":t.content.imageUrl=await this.upload(e.content),this.setFileInfo(t,e.content);break;case"audio":t.content.audioUrl=await this.upload(e.content),this.setFileInfo(t,e.content);break;case"video":t.content.videoUrl=await this.upload(e.content),this.setFileInfo(t,e.content);break;case"file":t.content.fileUrl=await this.upload(e.content),this.setFileInfo(t,e.content);break;default:return void console.error("不支持的类型"+e.type)}let n=this.$toast.loading(),a=await _.sendMessage(t);n.clear(),2e4!==a.code?this.$toast.fail({message:`发送失败：${a.message}`,closeOnClickOverlay:!0}):(this.$toast.success({message:"发送成功",closeOnClick:!0,duration:500}),a.data.self=!0,this.messages.push(a.data))},extendItemClick(e){console.log("扩展面板item点击了",e),"custom"==e.type&&this.$refs.mChat.toggleExtend()},setFileInfo(e,t){e.content.fileName=t.file.name,e.content.fileSize=t.file.size,e.content.fileExt=t.file.name.split(".").pop()}}},F=P,C=(0,l.Z)(F,w,x,!1,null,"f6dd3d46",null),E=C.exports;a["default"].use(h.ZP);const L=new h.ZP({mode:"history",routes:[{path:"/pc",component:b},{path:"/mobile",component:E}]});L.beforeEach(((e,t,n)=>{const a=/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent);e.query.code&&localStorage.setItem("code",e.query.code),a?"/mobile"!==e.path?n("/mobile"):n():"/pc"!==e.path?n("/pc"):n()}));var A=L,j=n(6849);a["default"].use(f()),a["default"].use(j.Z),a["default"].config.productionTip=!1,new a["default"]({render:e=>e(u),router:A}).$mount("#app")}},t={};function n(a){var o=t[a];if(void 0!==o)return o.exports;var i=t[a]={exports:{}};return e[a].call(i.exports,i,i.exports,n),i.exports}n.m=e,function(){var e=[];n.O=function(t,a,o,i){if(!a){var s=1/0;for(u=0;u<e.length;u++){a=e[u][0],o=e[u][1],i=e[u][2];for(var r=!0,l=0;l<a.length;l++)(!1&i||s>=i)&&Object.keys(n.O).every((function(e){return n.O[e](a[l])}))?a.splice(l--,1):(r=!1,i<s&&(s=i));if(r){e.splice(u--,1);var c=o();void 0!==c&&(t=c)}}return t}i=i||0;for(var u=e.length;u>0&&e[u-1][2]>i;u--)e[u]=e[u-1];e[u]=[a,o,i]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};n.O.j=function(t){return 0===e[t]};var t=function(t,a){var o,i,s=a[0],r=a[1],l=a[2],c=0;if(s.some((function(t){return 0!==e[t]}))){for(o in r)n.o(r,o)&&(n.m[o]=r[o]);if(l)var u=l(n)}for(t&&t(a);c<s.length;c++)i=s[c],n.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return n.O(u)},a=self["webpackChunkweb"]=self["webpackChunkweb"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=n.O(void 0,[998],(function(){return n(2269)}));a=n.O(a)})();
//# sourceMappingURL=app.bd360968.js.map